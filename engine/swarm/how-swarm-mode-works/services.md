---
description: How swarm mode services work
keywords: docker, container, cluster, swarm mode, node
title: How services work
---

要在Docker 引擎处于swarm模式时部署应用，您需要创建一个服务。通常，服务是在一些较大应用上下文中的微服务映像。服务的示例包括HTTP服务器、数据库或您希望在分布式环境中运行的任何其他类型的可执行程序。

创建服务时，您可以指定要使用的容器镜像以及在运行容器时执行的命令。您还定义服务的选项，包括：

* 集群将在外部提供服务端口；
* overlay网络，用于服务连接到群中的其他服务；
* CPU和内存限制和预留额度；
* 滚动更新策略；
* 要在集群中运行的容器数；

## 服务，任务和容器

当您将服务部署到群集时，swarm管理节点接收服务信息，并作为服务状态。然后它在swarm节点上将服务调度为一个或多个副本任务。这些任务在集群的节点上彼此独立地运行。

例如，假设您希望在HTTP侦听器的三个实例之间加载平衡。下图显示了具有三个副本的HTTP侦听器服务。侦听器的三个实例中的每一个都是集群中独立的任务。

![services diagram](../images/services-diagram.png)

容器是一个孤立的进程。在swarm模式中，每个任务运行一个容器。任务类似于调度器放置在容器的“槽”。一旦容器启动，调度程序就会识别任务处于运行状态。如果容器运行状况检查为失败或终止，任务将终止。

## 任务和调度

任务是集群内调度的原子单位。当通过创建或更新服务来声明服务状态时，调度器通过调度任务来实现所需的状态。例如，您定义一个服务，指示调度器保持HTTP侦听器的三个实例始终运行。调度器会创建三个任务，每个任务是一个槽，调度器通过生成容器来填充。容器是任务的实例化。如果HTTP侦听器任务随后健康检查失败或崩溃，则调度器器会创建一个新的副本，并生成新容器。

任务是单向的。它通过一系列状态单调地执行：分配，准备，运行等。如果任务失败，调度器会删除任务及其容器，然后根据服务指定的期望状态创建新任务来替换它。

Docker swarm模式的基本逻辑是通用调度器和协调器。服务和任务不知道它们实现的容器。假设你可以实现其他类型的任务，如虚拟机任务或非容器化的流程任务。调度器和协调器对它们运行的任务类型是不可知的。但是，当前版本的Docker仅支持容器任务。

下图显示了swarm模式如何接受服务创建请求和将任务调度到工作节点。

![services flow](../images/service-lifecycle.png)

## 复制的和全局的服务
有两种类型的服务部署，复制和全局。

对于复制类型服务，可以指定要运行任务的数量。例如，您决定部署具有三个副本的HTTP服务，每个副本都提供相同的内容。

全局服务是在每个节点上运行一个任务的服务。没有预先指定数量的任务。每次向swarm中添加节点时，协调器都会创建一个任务，并且调度器会将任务分配给新节点。全局服务的典型应用场景是监视代理、防病毒扫描或其他类型的容器（您希望在集群中的每个节点上运行）。

下图黄色的表示复制类型的三个服务，灰色表示全局类型服务。

![global vs replicated services](../images/replicated-vs-global.png)

## 更多

* 参考Swarm模式下 [节点](services.md) 如何工作.
* 参考Swarm模式下 [PKI](pki.md) 如何工作.
